export interface VulnerabilityTemplate {
  type: string;
  overview: string;
  generalRecommendations: string[];
  references: Array<{ title: string; url: string }>;
  generalImpacts: string[];
  cwe?: string;
  owasp?: string;
}

export const VULNERABILITY_DATABASE: Record<string, VulnerabilityTemplate> = {
  'SQL_INJECTION': {
    type: 'SQL Injection',
    overview: `SQL Injection is a code injection technique that exploits security vulnerabilities in an application's database layer. This vulnerability occurs when user-supplied input is incorporated into SQL queries without proper sanitization or parameterization. An attacker can manipulate SQL queries by injecting malicious SQL code through input fields, URL parameters, or HTTP headers. This can lead to unauthorized access to sensitive data, modification or deletion of database records, and in some cases, complete system compromise. SQL injection remains one of the most critical web application vulnerabilities and is consistently ranked in the OWASP Top 10.`,
    generalRecommendations: [
      '**Use Parameterized Queries**: Implement prepared statements with parameterized queries for all database interactions. This ensures that user input is treated as data, not executable code.',
      '**Input Validation**: Implement strict input validation on both client and server sides. Use allowlists to define acceptable input patterns.',
      '**Least Privilege Principle**: Configure database accounts with minimal necessary permissions. Application accounts should not have administrative privileges.',
      '**Web Application Firewall (WAF)**: Deploy a WAF with rules to detect and block SQL injection attempts.',
      '**Regular Security Testing**: Conduct periodic penetration testing and code reviews to identify potential SQL injection vulnerabilities.'
    ],
    references: [
      { title: 'OWASP: SQL Injection', url: 'https://owasp.org/www-community/attacks/SQL_Injection' },
      { title: 'CWE-89: Improper Neutralization of Special Elements used in an SQL Command', url: 'https://cwe.mitre.org/data/definitions/89.html' },
      { title: 'OWASP SQL Injection Prevention Cheat Sheet', url: 'https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html' },
      { title: 'PortSwigger: SQL Injection', url: 'https://portswigger.net/web-security/sql-injection' }
    ],
    generalImpacts: [
      '**Data Breach**: An attacker could extract sensitive information including user credentials, personal data, financial records, and proprietary business information.',
      '**Authentication Bypass**: Attackers could bypass login mechanisms and gain unauthorized access to user accounts, including administrative accounts.',
      '**Data Manipulation**: The database could be modified or deleted, leading to data integrity issues and potential business disruption.',
      '**System Compromise**: In severe cases, attackers may execute operating system commands through database functions, leading to full server compromise.'
    ],
    cwe: 'CWE-89',
    owasp: 'A03:2021 – Injection'
  },

  'XSS': {
    type: 'Cross-Site Scripting (XSS)',
    overview: `Cross-Site Scripting (XSS) is a client-side code injection attack where malicious scripts are injected into trusted websites. XSS occurs when an application includes untrusted data in a web page without proper validation or escaping. When victims load the affected page, the malicious script executes in their browser, allowing attackers to steal session tokens, cookies, or other sensitive information, perform actions on behalf of the victim, or redirect users to malicious websites. XSS vulnerabilities are classified into three main types: Reflected XSS (non-persistent), Stored XSS (persistent), and DOM-based XSS.`,
    generalRecommendations: [
      '**Output Encoding**: Implement context-aware output encoding for all user-supplied data displayed in HTML, JavaScript, CSS, or URL contexts.',
      '**Content Security Policy (CSP)**: Deploy a strict Content Security Policy to prevent execution of unauthorized scripts.',
      '**Input Validation**: Validate and sanitize all user input on the server side. Use allowlists to define acceptable input patterns.',
      '**HTTPOnly and Secure Flags**: Set HTTPOnly and Secure flags on all sensitive cookies to prevent JavaScript access and ensure transmission over HTTPS.',
      '**Modern Framework Usage**: Utilize modern web frameworks with built-in XSS protection mechanisms (React, Angular, Vue.js).'
    ],
    references: [
      { title: 'OWASP: Cross-Site Scripting (XSS)', url: 'https://owasp.org/www-community/attacks/xss/' },
      { title: 'CWE-79: Improper Neutralization of Input During Web Page Generation', url: 'https://cwe.mitre.org/data/definitions/79.html' },
      { title: 'OWASP XSS Prevention Cheat Sheet', url: 'https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html' },
      { title: 'PortSwigger: Cross-Site Scripting', url: 'https://portswigger.net/web-security/cross-site-scripting' }
    ],
    generalImpacts: [
      '**Session Hijacking**: Attackers could steal session tokens or cookies, allowing them to impersonate legitimate users and gain unauthorized access.',
      '**Credential Theft**: Malicious scripts can capture keystrokes or create fake login forms to steal user credentials.',
      '**Malware Distribution**: XSS can be used to redirect users to malicious websites or trigger drive-by download attacks.',
      '**Defacement**: The application\'s appearance and functionality can be altered, damaging the organization\'s reputation and user trust.'
    ],
    cwe: 'CWE-79',
    owasp: 'A03:2021 – Injection'
  },

  'SSTI': {
    type: 'Server-Side Template Injection (SSTI)',
    overview: `Server-Side Template Injection (SSTI) is a vulnerability that occurs when user input is embedded into template engines without proper sanitization. Template engines are used to dynamically generate HTML, emails, or other text-based formats by combining templates with data. When an attacker can inject template directives into user-controllable input, they may be able to execute arbitrary code on the server. This vulnerability is particularly dangerous because it can lead to Remote Code Execution (RCE), allowing attackers to completely compromise the server. Common vulnerable template engines include Jinja2 (Python), Twig (PHP), Freemarker (Java), and ERB (Ruby).`,
    generalRecommendations: [
      '**Avoid User Input in Templates**: Never directly embed user-supplied data into template syntax. Use template variables and proper data binding instead.',
      '**Sandboxing**: If user input must be processed by templates, use sandboxed template engines with restricted functionality.',
      '**Input Validation**: Implement strict validation to reject input containing template syntax characters like {{, }}, ${, %>, etc.',
      '**Use Logic-less Templates**: Consider using logic-less template engines (like Mustache) that don\'t support code execution.',
      '**Security Updates**: Keep template engine libraries up-to-date with the latest security patches.'
    ],
    references: [
      { title: 'PortSwigger: Server-Side Template Injection', url: 'https://portswigger.net/web-security/server-side-template-injection' },
      { title: 'OWASP: Server-Side Template Injection', url: 'https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/18-Testing_for_Server-side_Template_Injection' },
      { title: 'CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine', url: 'https://cwe.mitre.org/data/definitions/1336.html' },
      { title: 'HackTricks: SSTI (Server Side Template Injection)', url: 'https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection' }
    ],
    generalImpacts: [
      '**Remote Code Execution**: Attackers can execute arbitrary code on the server, leading to complete system compromise.',
      '**Sensitive Data Exposure**: Access to server-side objects and configuration may expose database credentials, API keys, and other secrets.',
      '**Privilege Escalation**: Attackers may escalate privileges within the application or underlying system.',
      '**Lateral Movement**: Compromised servers can be used as pivot points to attack internal systems and resources.'
    ],
    cwe: 'CWE-1336',
    owasp: 'A03:2021 – Injection'
  },

  'COMMAND_INJECTION': {
    type: 'Command Injection',
    overview: `Command Injection is a security vulnerability that allows an attacker to execute arbitrary operating system commands on the server running the application. This vulnerability occurs when an application passes unsafe user-supplied data (forms, cookies, HTTP headers, etc.) to a system shell without proper validation or sanitization. Attackers can exploit this by injecting shell metacharacters and commands, potentially gaining complete control over the system. Command injection is particularly dangerous as it can lead to data theft, system manipulation, installation of backdoors, and pivot attacks to other systems on the network.`,
    generalRecommendations: [
      '**Avoid System Calls**: Whenever possible, use language-specific libraries and APIs instead of invoking system commands.',
      '**Input Validation**: Implement strict allowlist validation for any user input that must be used in system commands. Reject input containing shell metacharacters (;, |, &, $, `, \\n, etc.).',
      '**Command Parameterization**: If system commands are necessary, use parameterized APIs that separate commands from arguments.',
      '**Principle of Least Privilege**: Run application processes with minimal necessary permissions. Use dedicated service accounts with restricted access.',
      '**Escaping and Quoting**: If user input must be included in commands, properly escape all special characters using language-specific functions.'
    ],
    references: [
      { title: 'OWASP: Command Injection', url: 'https://owasp.org/www-community/attacks/Command_Injection' },
      { title: 'CWE-78: Improper Neutralization of Special Elements used in an OS Command', url: 'https://cwe.mitre.org/data/definitions/78.html' },
      { title: 'OWASP Command Injection Defense Cheat Sheet', url: 'https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html' },
      { title: 'PortSwigger: OS Command Injection', url: 'https://portswigger.net/web-security/os-command-injection' }
    ],
    generalImpacts: [
      '**Complete System Compromise**: Attackers can execute any command with the privileges of the application, potentially gaining full control of the server.',
      '**Data Exfiltration**: Sensitive files, databases, and configuration data can be accessed and transferred to attacker-controlled systems.',
      '**Malware Installation**: Attackers can download and execute malicious software, including backdoors, cryptominers, and ransomware.',
      '**Network Pivot**: The compromised system can be used to launch attacks against other systems in the internal network.'
    ],
    cwe: 'CWE-78',
    owasp: 'A03:2021 – Injection'
  },

  'NOSQL_INJECTION': {
    type: 'NoSQL Injection',
    overview: `NoSQL Injection is a vulnerability that targets applications using NoSQL databases such as MongoDB, CouchDB, Redis, or Cassandra. Similar to SQL injection, NoSQL injection occurs when user input is incorporated into database queries without proper validation or sanitization. However, NoSQL injection exploits the query syntax and operators specific to NoSQL databases. Attackers can manipulate query logic using operators like $gt, $ne, $where, or $regex to bypass authentication, extract data, or modify database content. The impact varies depending on the NoSQL database type and query language used (JSON-based, key-value, document-based, etc.).`,
    generalRecommendations: [
      '**Input Validation and Sanitization**: Validate and sanitize all user input, especially when constructing database queries. Reject input containing NoSQL operators like $, {, }, [, ].',
      '**Type Checking**: Enforce strict type checking for query parameters. Ensure that expected strings are actually strings, not objects or arrays.',
      '**Parameterized Queries**: Use parameterized queries or ORM/ODM libraries that provide built-in protection against injection.',
      '**Least Privilege**: Configure database user accounts with minimal necessary permissions. Avoid using admin accounts for application connections.',
      '**Query Allowlisting**: When possible, use predefined queries with limited user input rather than dynamically constructing queries.'
    ],
    references: [
      { title: 'OWASP: NoSQL Injection', url: 'https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/05.6-Testing_for_NoSQL_Injection' },
      { title: 'CWE-943: Improper Neutralization of Special Elements in Data Query Logic', url: 'https://cwe.mitre.org/data/definitions/943.html' },
      { title: 'HackerOne: NoSQL Injection Tutorial', url: 'https://www.hackerone.com/knowledge-center/nosql-injection' },
      { title: 'MongoDB Security Checklist', url: 'https://docs.mongodb.com/manual/administration/security-checklist/' }
    ],
    generalImpacts: [
      '**Authentication Bypass**: Attackers can bypass login mechanisms by manipulating authentication queries with operators like $ne or $gt.',
      '**Unauthorized Data Access**: Sensitive information can be extracted using operator injection or regex-based blind extraction techniques.',
      '**Data Manipulation**: Database records can be modified or deleted, compromising data integrity.',
      '**Denial of Service**: Resource-intensive queries can be injected to cause performance degradation or service outages.'
    ],
    cwe: 'CWE-943',
    owasp: 'A03:2021 – Injection'
  },

  'LDAP_INJECTION': {
    type: 'LDAP Injection',
    overview: `LDAP Injection is an attack technique that exploits applications using Lightweight Directory Access Protocol (LDAP) for authentication or data retrieval. When user input is incorporated into LDAP queries without proper sanitization, attackers can modify the query logic by injecting LDAP filter metacharacters. This can lead to authentication bypass, unauthorized information disclosure, and privilege escalation. LDAP injection is particularly concerning in enterprise environments where LDAP directories (like Active Directory) contain sensitive organizational data, user credentials, and access control information.`,
    generalRecommendations: [
      '**Input Validation**: Implement strict validation to reject or escape LDAP special characters including *, (, ), \\, /, null bytes, and control characters.',
      '**Use LDAP Libraries**: Utilize secure LDAP libraries that provide built-in input sanitization and parameterized query support.',
      '**Escaping Functions**: Properly escape user input using LDAP-specific escaping functions before incorporating it into queries.',
      '**Principle of Least Privilege**: Configure LDAP bind accounts with minimal necessary permissions. Avoid using administrative accounts for application queries.',
      '**Defense in Depth**: Implement multiple layers of security including network segmentation, monitoring, and rate limiting for LDAP queries.'
    ],
    references: [
      { title: 'OWASP: LDAP Injection', url: 'https://owasp.org/www-community/attacks/LDAP_Injection' },
      { title: 'CWE-90: Improper Neutralization of Special Elements used in an LDAP Query', url: 'https://cwe.mitre.org/data/definitions/90.html' },
      { title: 'OWASP LDAP Injection Prevention Cheat Sheet', url: 'https://cheatsheetseries.owasp.org/cheatsheets/LDAP_Injection_Prevention_Cheat_Sheet.html' },
      { title: 'PortSwigger: LDAP Injection', url: 'https://portswigger.net/kb/issues/00100500_ldap-injection' }
    ],
    generalImpacts: [
      '**Authentication Bypass**: Attackers can manipulate LDAP authentication queries to gain unauthorized access without valid credentials.',
      '**Information Disclosure**: Sensitive directory information including user attributes, group memberships, and organizational structure can be extracted.',
      '**Privilege Escalation**: By modifying queries, attackers may access administrative accounts or sensitive resources beyond their authorization level.',
      '**Account Enumeration**: Valid usernames and account information can be discovered through LDAP query manipulation.'
    ],
    cwe: 'CWE-90',
    owasp: 'A03:2021 – Injection'
  },

  'XXE': {
    type: 'XML External Entity (XXE) Injection',
    overview: `XML External Entity (XXE) Injection is a vulnerability that targets applications that parse XML input. This attack exploits weakly configured XML parsers that process external entity references within XML documents. When an application accepts XML input from untrusted sources, an attacker can include malicious external entity declarations that cause the parser to access local or remote resources. XXE attacks can lead to sensitive file disclosure, Server-Side Request Forgery (SSRF), denial of service, and in some cases remote code execution. This vulnerability is particularly dangerous because many developers are unaware of the risks associated with XML parsing.`,
    generalRecommendations: [
      '**Disable External Entities**: Configure XML parsers to disable processing of external entities and DTDs (Document Type Definitions).',
      '**Use Less Complex Data Formats**: When possible, use simpler data formats like JSON instead of XML for data exchange.',
      '**Input Validation**: Validate XML input against a strict schema (XSD) and reject documents containing DOCTYPE declarations or external entity references.',
      '**Update XML Libraries**: Keep XML parsing libraries up-to-date with the latest security patches.',
      '**Least Privilege**: Ensure the application runs with minimal file system and network access permissions to limit XXE impact.'
    ],
    references: [
      { title: 'OWASP: XML External Entity (XXE) Processing', url: 'https://owasp.org/www-community/vulnerabilities/XML_External_Entity_(XXE)_Processing' },
      { title: 'CWE-611: Improper Restriction of XML External Entity Reference', url: 'https://cwe.mitre.org/data/definitions/611.html' },
      { title: 'OWASP XXE Prevention Cheat Sheet', url: 'https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html' },
      { title: 'PortSwigger: XML External Entity (XXE) Injection', url: 'https://portswigger.net/web-security/xxe' }
    ],
    generalImpacts: [
      '**Sensitive File Disclosure**: Attackers can read local files on the server, including configuration files containing credentials, source code, and system files like /etc/passwd.',
      '**Server-Side Request Forgery (SSRF)**: The XML parser can be used to make requests to internal systems, potentially accessing internal APIs or services.',
      '**Denial of Service**: Billion Laughs attack and other recursive entity definitions can cause resource exhaustion and service crashes.',
      '**Remote Code Execution**: In certain configurations with specific features enabled, XXE can lead to remote code execution.'
    ],
    cwe: 'CWE-611',
    owasp: 'A05:2021 – Security Misconfiguration'
  }
};

export function getVulnerabilityTemplate(type: string): VulnerabilityTemplate | undefined {
  return VULNERABILITY_DATABASE[type.toUpperCase().replace(/[^A-Z_]/g, '_')];
}
