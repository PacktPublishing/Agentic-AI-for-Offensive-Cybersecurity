{
  "name": "CTI Query Agent",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        -400,
        -112
      ],
      "id": "773a655b-c550-42eb-822c-1d2272362064",
      "name": "When chat message received",
      "webhookId": "0f17e846-aeb5-4620-849c-0ed10ff62558"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=  You are a Cyber Threat Intelligence analyst assistant. Your role is to help security teams understand and act on threat intelligence data.\n\n  When you search the threat intelligence database, the results contain:\n  - indicator: The actual IOC value (IP, domain, hash, URL)\n  - type: The indicator type (IPv4, domain, FileHash-SHA256, etc.)\n  - pulseName: The threat campaign name\n  - tags: Related tags\n  - malwareFamilies: Associated malware\n\n  Always include the actual indicator values in your response. When answering questions:\n  1. Search the threat intelligence database for relevant indicators\n  2. List specific IOC values (IPs, domains, hashes) found in the results\n  3. Include the indicator type and associated campaign name\n  4. If no relevant data is found, clearly state this"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -128,
        -112
      ],
      "id": "71c7377d-2807-447d-a274-903f03a35416",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -208,
        112
      ],
      "id": "de1732b0-46e0-4fdb-aeb7-c8f48652d265",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "5VDd362hpABYIrAx",
          "name": "OpenAi account 2"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        160,
        208
      ],
      "id": "2551d738-0aa0-4e4e-853e-a7fbdb48f4d7",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "5VDd362hpABYIrAx",
          "name": "OpenAi account 2"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Search the threat intelligence database for Indicators of Compromise (IOCs). This tool contains malicious IP addresses, domains, URLs, file hashes, and other indicators collected from AlienVault OTX threat feeds. Use this tool to find IOCs related to specific malware families, threat campaigns, or indicator types. Returns relevant IOCs with context about their associated threats.",
        "qdrantCollection": {
          "__rl": true,
          "value": "threat-intelligence",
          "mode": "list",
          "cachedResultName": "threat-intelligence"
        },
        "topK": 20,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
      "typeVersion": 1.3,
      "position": [
        160,
        32
      ],
      "id": "024a0499-0043-4a52-a8c8-2e8401830481",
      "name": "search_threat_intelligence",
      "credentials": {
        "qdrantApi": {
          "id": "OvOsfpGu3jNvJPnQ",
          "name": "QdrantApi account"
        }
      }
    },
    {
      "parameters": {
        "contextWindowLength": 2000
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -48,
        112
      ],
      "id": "e53ddc9a-83a8-4050-bfb5-c81e76240728",
      "name": "Simple Memory"
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "search_threat_intelligence",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "search_threat_intelligence": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "1716c876-e8c6-4db5-8f31-25fb3d7271d0",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "33a6384be4595f666734840b1a2564f4ca97d56c3047e8f1501a8302d137aba7"
  },
  "id": "b2Bm4hmYD1GI21c7",
  "tags": []
}